## 6장-1 AOP

6장을 나눠서 정리해보았다. AOP를 바르게 이용하려면 AOP의 등장배경과 스프링이 이를 도입한 이유,
적용으로 얻을 수 있는 장점이 무엇인지 이해해야한다. 

---

#### 트랜잭션 경계설정 코드 분리의 장점

트랜잭션 경계설정 코드를 분리해서 별도의 클래스로 만들고 비즈니스 로직 클래스와 동일한 인터페이스를 구현하면 DI의
확장기능을 이용해 클라이언트의 변경 없이도 깔끔하게 분리된 트랜잭션 부가기능을 만들 수 있다. 

비즈니스 로직에만 충실한 테스트를 만들 수 있다. 

## 고립된 단위 테스트

가장 편하고 좋은 테스트 방법은 가능한 한 작은 단위로 쪼개서 테스트하는 것이다. 원인을 찾기 쉽기 때문이다. 
그러나 테스트 대상이 다른 오브젝트와 환경에 의존하고 있다면 작은 단위의 테스트가 주는 장점을 얻기 힘들다. 


UserService는 UserDao, TransactionManger, MailSender라는 세 가지 의존 관계를 갖고 있다. 따라서 그 세가지 의존관계를 갖는 오브젝트들이 테스트가 진행되는 동안 같이 실행된다.
즉, UserSevice를 테스트하는 로직은 UserService를 테스트하는 것처럼 보이지만 그 뒤에 존재하는 훨씬 더 많은
오브젝트와 환경, 서비스, 서버까지 함게 테스트하는 셈이된다. 
이 경우 테스트는 준비하기 힘들고, 환경이 조금이라도 달라지면 동일한 테스트 결과를 내지 못할 수도 있다.


그래서 테스트의 대상이 환경이나, 외부 서버, 다른 클래스의 코드에 종속되고 영향을 받지 않도록 대상을 고립시킬 필요가 있다. 
테스트를 의존 대상으로부터 분리해서 고립시키는 방법은 '테스트를 위한 대역'을 사용하는 것이다. 

책에서는 목 오브젝트를 만들어 테스트 대역을 사용했던 방법을 적용해 코드를 수정했다.

#### 고립 단위 테스트의 장점

* 테스트만을 위해 완전히 독립적으로 동작하는 테스트 대상을 사용하기 때문에 스프링 컨테이너에서 빈을 가져올 필요가 없다. 

* DB 연동, 실행 & 메일 서버 등을 이용하지 않으므로 테스트 수행 성능이 향상된다. 

* 실제 운용환경에도 영향을 미치지 않는다.


#### 단위 테스트와 통합 테스트

##### 단위 테스트

하나의 단위에 초점을 맞춘 테스트이다. 이 책에서는 테스트 대상 클래스를 목 오브젝트 등의 테스트 대역을 이용해 의존 오브젝트나 외부의 리소스를 사용하지 않도록 고립시켜서 테스트하는 것을 단위 테스트라고 부르기로 했다. 

##### 통합 테스트

두 개 이상의, 성격이나 계층이 다른 오브젝트가 연동하도록 만들어 테스트하거나, 또는 외부의 DB나 파일, 서비스 등의 리소스가 참여하는 테스트를 의미한다.
(이 책에서)

즉, 통합 테스트란 두 개 이상의 단위가 결합해서 동작하면서 테스트가 수행되는 것이다.

##### 단위 테스트와 통합 테스트는 언제 사용해야할까?

* 항상 단위 테스트를 먼저 고려한다.
* 하나의 클래스나 성격과 목적이 같은 긴밀한 클래스 몇개를 모아서 외부와의 의존관계를 모두 차단하고 필요에 따라 스텁이나 목 오브젝트 등의 테스트 대역을 이용하도록 테스트를 만든다. 
* 외부 리소스를 사용해야만 가능한 테스트는 통합 테스트로 만든다.
* DAO 테스트는 DB라는 외부 리소스를 사용하기 때문에 통합 테스트로 분류된다. 
* 여러 개의 단위가 의존관계를 가지고 동작할 때를 위한 통합 테스트는 필요하다. 
* 단위 테스트를 만들기가 너무 복잡하다고 판단되는 코드는 처음부터 통합 테스트를 고려해본다. 
* 스프링 테스트 컨텍스트 프레임워크를 이용하는 테스트는 통합 테스트다. 


##### 목 프레임 -워크

단위 테스트의 단점은 작성이 번거롭다는 점이다. 특히 목 오브젝트를 만드는 일이 가장 큰 짐이다.
목 오브젝트 지원 프레임워크가 목 오브젝트를 편리하게 작성하도록 지원해준다. 

* Mockito

사용하기 편리하고 코드도 직관적이라 최근 많은 인기를 끌고 있다.(?)
목 클래스를 일일이 준비해둘 필요가 없다는 점이 특징이다.
간단한 메소드 호출만드로 다이내믹하게 특정 인터페이스를 구현한 테스트용 목 오브젝트를 생성할 수 있다.

* Mockito 목 오브젝트 사용 단계

1. 인터페이스를 이용해 목 오브젝트를 만든다. 
2. 목 오브젝트가 리턴할 값이 있으면 이를 지정해준다. 메소드가 호출되면 예외를 강제로 던지게 만들 수도 있다.
3. 테스트 대상 오브젝트에 DI 해서 목 오브젝트가 테스트 중에 사용되도록 만든다.
4. 테스트 대상 오브젝트를 사용한 후에 목 오브젝트의 특정 메소드가 호출됐는지, 어떤 값을 가지로 몇 번 호출됐는지를 검증한다. 



